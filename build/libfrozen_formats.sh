#!/bin/sh

keys=`grep "FORMAT([a-z0-9_]*)" -roha ./ | sed "s/FORMAT(//g" | sed "s/)//g"  | LC_ALL=C sort -u`
format_h=src/libfrozen/data/enum/format/format.h
format_swig=src/lang/format.i

i=0
echo "/* Autogenerated file. Don't edit */" > $format_h
echo "#ifndef FORMAT_H" >> $format_h
echo "#define FORMAT_H" >> $format_h
echo "" >> $format_h
echo "typedef struct keypair_t {" >> $format_h
echo "    char *        key_str;" >> $format_h
echo "    uintmax_t     key_val;" >> $format_h
echo "} keypair_t;" >> $format_h
echo "" >> $format_h
echo "extern keypair_t formats[];" >> $format_h
echo "extern size_t formats_size;" >> $format_h
echo "extern size_t formats_nelements;" >> $format_h
echo "" >> $format_h
echo "#define FORMAT(value)         FORMAT_##value" >> $format_h
echo "typedef uintmax_t format_t;" >> $format_h
echo "" >> $format_h
for a in $keys; do
	i=$(($i+1))
	echo "#define FORMAT_$a $i" >> $format_h
done
echo "#endif" >> $format_h
i=0
echo "#ifdef FORMAT_C" >> $format_h
echo "keypair_t formats[] = {" >> $format_h
for a in $keys; do
	i=$(($i+1))
	echo "{ \"$a\", $i }, " >> $format_h
done
echo "};" >> $format_h
echo "size_t formats_size       = sizeof(formats[0]);" >> $format_h
echo "size_t formats_nelements  = (sizeof(formats)/sizeof(formats[0]));" >> $format_h
echo "#endif" >> $format_h


i=0
echo "/* Autogenerated file. Don't edit */" > $format_swig
for a in $keys; do
	i=$(($i+1))
	echo "%constant uintmax_t FORMAT_$a = $i;" >> $format_swig
done
echo "" >> $format_swig
