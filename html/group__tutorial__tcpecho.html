<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>frozen: Tutorial: tcp echo server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">frozen&#160;<span id="projectnumber">1.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: tcp echo server</div>  </div>
<div class="ingroups"><a class="el" href="group__tutorial.html">Tutorials</a></div></div>
<div class="contents">
<table class="memberdecls">
</table>
<p>Most simplest tcp server is one thread per one connection + one thread for accepting new connections. Let's create such server. </p>
<div class="fragment"><pre class="fragment"> { <span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;daemon/thread&quot;</span>, loop = (uint_t)<span class="charliteral">&#39;1&#39;</span> },
 { <span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;io/tcp&quot;</span>, addr = <span class="stringliteral">&quot;0.0.0.0&quot;</span>, port = (uint_t)<span class="stringliteral">&#39;12345&#39;</span> }
</pre></div><p>As we can see there is one thread created using <a class="el" href="group__mod__backend__thread.html">daemon/thread</a> in loop mode and <a class="el" href="group__mod__backend__tcp.html">io/tcp</a> which listen 0.0.0.0:12345 port. Such construction only accept new connections and try create new backend chain. Because we didn't specified one - there would be error. So, with specified backend it would look like this: </p>
<div class="fragment"><pre class="fragment">{ <span class="keyword">class</span>=&gt; <span class="stringliteral">&quot;daemon/thread&quot;</span>, loop = (uint_t)<span class="charliteral">&#39;1&#39;</span>, ignore_errors = (uint_t)<span class="charliteral">&#39;1&#39;</span> },
{ <span class="keyword">class</span>=&gt; <span class="stringliteral">&quot;io/tcp&quot;</span>, addr = <span class="stringliteral">&quot;0.0.0.0&quot;</span>, port = (uint_t)<span class="stringliteral">&#39;12345&#39;</span>, backend = {
        { <span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;daemon/thread&quot;</span>, loop = (uint_t)<span class="charliteral">&#39;1&#39;</span> },
        { <span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;data/transfer&quot;</span>,
                source =&gt; {
                        { <span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;io/tcp_child&quot;</span> }
                },
                destination =&gt; {
                        { <span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;io/tcp_child&quot;</span> }
                }
        }
}
}
</pre></div><p>In beginning of new backend chain there is one <a class="el" href="group__mod__backend__thread.html">daemon/thread</a> in loop mode in pair with <a class="el" href="group__mod__backend__transfer.html">data/transfer</a>, next comes two special "io/tcp_child" backends which represent newly connected socket. Backend chain can contain any number of such backends, and each of them represent same socket. Read request to this backend causes read from socket and write request - write to it.</p>
<p>Note, <a class="el" href="group__mod__backend__transfer.html">data/transfer</a> first try fast api to transfer, if it possible, but if one of backends in chain don't have it - request downgraded and passed through hash api. This will cause performance decrease. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 16 2011 17:05:43 for frozen by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
